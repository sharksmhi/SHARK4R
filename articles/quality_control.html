<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quality Control of SHARK Data • SHARK4R</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quality Control of SHARK Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SHARK4R</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/retrieve_shark_data.html">Retrieve SHARK Data</a></li>
    <li><a class="dropdown-item" href="../articles/retrieve_dyntaxa_data.html">Retrieve Dyntaxa Data</a></li>
    <li><a class="dropdown-item" href="../articles/retrieve_worms_data.html">Retrieve WoRMS Data</a></li>
    <li><a class="dropdown-item" href="../articles/retrieve_algaebase_data.html">Retrieve AlgaeBase Data</a></li>
    <li><a class="dropdown-item" href="../articles/retrieve_hab_data.html">Retrieve HAB Data</a></li>
    <li><a class="dropdown-item" href="../articles/retrieve_nordic_microalgae_data.html">Retrieve Nordic Microalgae Data</a></li>
    <li><a class="dropdown-item" href="../articles/quality_control.html">QC of SHARK Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sharksmhi/SHARK4R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Quality Control of SHARK Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sharksmhi/SHARK4R/blob/master/vignettes/quality_control.Rmd" class="external-link"><code>vignettes/quality_control.Rmd</code></a></small>
      <div class="d-none name"><code>quality_control.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The SHARK4R package provides a set of functions to perform quality
control (QC) on SHARK data. These functions help identify missing or
invalid values, spatial errors, and statistical outliers and are mainly
intended for internal data validation. The tutorial covers:</p>
<ul>
<li>
<strong>Field validation</strong> (required and datatype-specific
fields)<br>
</li>
<li>
<strong>Code validation</strong> (project and platform codes)<br>
</li>
<li>
<strong>Geospatial checks</strong> (points on land, basins,
proximity to shore)<br>
</li>
<li>
<strong>Depth checks</strong> (missing, negative, or implausible
values)<br>
</li>
<li>
<strong>Outlier detection</strong> (parameter-specific
thresholds)<br>
</li>
<li>
<strong>Logical Parameter Checks</strong> (parameter-specific
rules)<br>
</li>
<li>
<strong>Interactive QC</strong> with a Shiny app</li>
</ul>
<p>This workflow ensures SHARK data are consistent, valid, and ready for
analysis. Several quality control components, originally developed by
Provoost and Bosch (2018), have been adapted for compatibility with the
SHARK format.</p>
<hr>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the latest version of <code>SHARK4R</code> from CRAN
using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"SHARK4R"</span><span class="op">)</span></span></code></pre></div>
<p>Load the package along with <code>dplyr</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sharksmhi.github.io/SHARK4R/">SHARK4R</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="retrieve-shark-data">Retrieve SHARK Data<a class="anchor" aria-label="anchor" href="#retrieve-shark-data"></a>
</h2>
<p>You can fetch SHARK data using the same filtering options as the
SHARK web interface. Explore available options with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shark_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_shark_options.html">get_shark_options</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Filter datasets containing “Chlorophyll”:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter names using grepl</span></span>
<span><span class="va">chlorophyll_datasets</span> <span class="op">&lt;-</span> <span class="va">shark_options</span><span class="op">$</span><span class="va">datasets</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Chlorophyll"</span>, </span>
<span>                                                     <span class="va">shark_options</span><span class="op">$</span><span class="va">datasets</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Select the first dataset for demonstration</span></span>
<span><span class="va">selected_dataset</span> <span class="op">&lt;-</span> <span class="va">chlorophyll_datasets</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Print the name of the selected dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">selected_dataset</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "SHARK_Chlorophyll_1985_1989_SMHI_version_2023-04-27.zip"</span></span></code></pre>
<p>Download the selected dataset as a data frame:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chlorophyll_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_shark_datasets.html">get_shark_datasets</a></span><span class="op">(</span><span class="va">selected_dataset</span>,</span>
<span>                                       save_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                       return_df <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">chlorophyll_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 80 × 73</span></span></span>
<span><span class="co">##    source delivery_datatype check_status_sv data_checked_by_sv visit_year</span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>985</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>      1 Chlorophyll       Klar            Leverantör               <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 70 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 68 more variables: visit_month &lt;dbl&gt;, station_name &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   reported_station_name &lt;chr&gt;, sample_location_id &lt;dbl&gt;, station_id &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   sample_project_name_en &lt;chr&gt;, sample_orderer_name_en &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   platform_code &lt;chr&gt;, visit_id &lt;dbl&gt;, expedition_id &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   shark_sample_id_md5 &lt;chr&gt;, sample_date &lt;date&gt;, sample_time &lt;time&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   sample_enddate &lt;lgl&gt;, sample_endtime &lt;lgl&gt;, sample_latitude_dm &lt;chr&gt;, …</span></span></span></code></pre>
<p>SHARK data can be downloaded and saved locally using the
<code>save_dir</code> argument, then imported into R using the function
<code><a href="../reference/read_shark.html">read_shark()</a></code> for both ZIP archives or text files.</p>
<hr>
</div>
<div class="section level2">
<h2 id="step-1-check-required-fields">Step 1: Check Required Fields<a class="anchor" aria-label="anchor" href="#step-1-check-required-fields"></a>
</h2>
<p>Validate mandatory fields:</p>
<ul>
<li>
<strong>Global fields</strong>: <code><a href="../reference/check_datatype.html">check_datatype()</a></code><br>
</li>
<li>
<strong>Datatype-specific fields</strong>:
<code><a href="../reference/check_fields.html">check_fields()</a></code> with optional
<code>field_definitions</code>
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_fields.html">check_fields</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span>, datatype <span class="op">=</span> <span class="st">"Chlorophyll"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,195 × 4</span></span></span>
<span><span class="co">##    level field                           row message                            </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> error sample_project_name_sv           <span style="color: #BB0000;">NA</span> Required field sample_project_name…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> error sample_orderer_name_sv           <span style="color: #BB0000;">NA</span> Required field sample_orderer_name…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> error sampling_laboratory_name_sv      <span style="color: #BB0000;">NA</span> Required field sampling_laboratory…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> error analytical_laboratory_name_sv    <span style="color: #BB0000;">NA</span> Required field analytical_laborato…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> error reporting_institute_name_sv      <span style="color: #BB0000;">NA</span> Required field reporting_institute…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> error sample_enddate                    1 Empty value for required field sam…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> error sample_enddate                    2 Empty value for required field sam…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> error sample_enddate                    3 Empty value for required field sam…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> error sample_enddate                    4 Empty value for required field sam…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> error sample_enddate                    5 Empty value for required field sam…</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,185 more rows</span></span></span></code></pre>
<hr>
</div>
<div class="section level2">
<h2 id="step-2-validate-project-and-platform-codes">Step 2: Validate Project and Platform Codes<a class="anchor" aria-label="anchor" href="#step-2-validate-project-and-platform-codes"></a>
</h2>
<p>Ensure metadata codes follow SHARK conventions:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate project codes</span></span>
<span><span class="fu"><a href="../reference/check_codes.html">check_codes</a></span><span class="op">(</span><span class="va">chlorophyll_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## All PROJ codes found</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">##   reported_code              match_type</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> National marine monitoring TRUE</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate ship/platform codes</span></span>
<span><span class="fu"><a href="../reference/check_codes.html">check_codes</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span>, </span>
<span>            field <span class="op">=</span> <span class="st">"platform_code"</span>, </span>
<span>            code_type <span class="op">=</span> <span class="st">"SHIPC"</span>, </span>
<span>            match_column <span class="op">=</span> <span class="st">"Code"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## All SHIPC codes found</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">##   reported_code match_type</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 77AR          TRUE      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 77SN          TRUE</span></span></code></pre>
<hr>
</div>
<div class="section level2">
<h2 id="step-3-geospatial-checks">Step 3: Geospatial Checks<a class="anchor" aria-label="anchor" href="#step-3-geospatial-checks"></a>
</h2>
<div class="section level3">
<h3 id="visualize-data-points">Visualize Data Points<a class="anchor" aria-label="anchor" href="#visualize-data-points"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_map_leaflet.html">plot_map_leaflet</a></span><span class="op">(</span><span class="va">chlorophyll_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The interactive map is omitted here but appears in the online tutorial.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="identify-points-on-land">Identify Points on Land<a class="anchor" aria-label="anchor" href="#identify-points-on-land"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_rows_on_land</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_onland.html">check_onland</a></span><span class="op">(</span><span class="va">chlorophyll_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">n_rows_on_land</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<p>Optional geospatial QC functions:</p>
<ul>
<li>
<code><a href="../reference/positions_are_near_land.html">positions_are_near_land()</a></code><br>
</li>
<li>
<code><a href="../reference/which_basin.html">which_basin()</a></code> from the <a href="https://CRAN.R-project.org/package=iRfcb" class="external-link">iRfcb package</a>
</li>
</ul>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="step-4-depth-checks">Step 4: Depth Checks<a class="anchor" aria-label="anchor" href="#step-4-depth-checks"></a>
</h2>
<p>Verify plausibility and consistency of depth values:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_depth.html">check_depth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span><span class="op">)</span> <span class="co"># default columns: min/max depth</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">##   level     row field              message                                      </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> warning    17 sample_max_depth_m Depth value (20) is greater than the value f…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> warning    80 sample_max_depth_m Depth value (20) is greater than the value f…</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_depth.html">check_depth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span>, <span class="st">"water_depth_m"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 57 × 4</span></span></span>
<span><span class="co">##    level     row field         message                                          </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> warning     2 water_depth_m Depth value (78) is greater than the value found…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> warning     3 water_depth_m Depth value (78) is greater than the value found…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> warning     4 water_depth_m Depth value (637) is greater than the value foun…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> warning     6 water_depth_m Depth value (86) is greater than the value found…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> warning     8 water_depth_m Depth value (25) is greater than the value found…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> warning     9 water_depth_m Depth value (41) is greater than the value found…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> warning    10 water_depth_m Depth value (90) is greater than the value found…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> warning    11 water_depth_m Depth value (74) is greater than the value found…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> warning    13 water_depth_m Depth value (465) is greater than the value foun…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> warning    14 water_depth_m Depth value (465) is greater than the value foun…</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 47 more rows</span></span></span></code></pre>
<p>Checks performed:</p>
<ul>
<li>Missing depth column or empty values (warnings)<br>
</li>
<li>Non-numeric or negative values (errors)<br>
</li>
<li>Depth exceeding bathymetry or minimum &gt; maximum (errors)</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="step-5-outlier-detection">Step 5: Outlier Detection<a class="anchor" aria-label="anchor" href="#step-5-outlier-detection"></a>
</h2>
<p>Retrieve reference statistics for your datatype:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shark_statistics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_shark_statistics.html">get_shark_statistics</a></span><span class="op">(</span>datatype <span class="op">=</span> <span class="st">"Chlorophyll"</span>,</span>
<span>                                         fromYear <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>                                         toYear <span class="op">=</span> <span class="fl">2024</span>,</span>
<span>                                         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">shark_statistics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 24</span></span></span>
<span><span class="co">##   parameter  datatype fromYear toYear     n   min    Q1 median    Q3   max   P01</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Chlorophy… Chlorop…     <span style="text-decoration: underline;">2</span>020   <span style="text-decoration: underline;">2</span>024  <span style="text-decoration: underline;">1</span>374  0.19  1.39    2.2   3.3  22.2 0.307</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 13 more variables: P05 &lt;dbl&gt;, P95 &lt;dbl&gt;, P99 &lt;dbl&gt;, IQR &lt;dbl&gt;, mean &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   sd &lt;dbl&gt;, var &lt;dbl&gt;, cv &lt;dbl&gt;, mad &lt;dbl&gt;, mild_lower &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   mild_upper &lt;dbl&gt;, extreme_lower &lt;dbl&gt;, extreme_upper &lt;dbl&gt;</span></span></span></code></pre>
<p>Detect extreme values using thresholds (e.g., 99th percentile):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_outliers.html">check_outliers</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span>,</span>
<span>               parameter <span class="op">=</span> <span class="st">"Chlorophyll-a"</span>,</span>
<span>               datatype <span class="op">=</span> <span class="st">"Chlorophyll"</span>,</span>
<span>               threshold_col <span class="op">=</span> <span class="st">"P99"</span>,</span>
<span>               thresholds <span class="op">=</span> <span class="va">shark_statistics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Chlorophyll-a is within the P99 range.</span></span></code></pre>
<p>Visualize anomalies:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scatterplot with horizontal line at 99th percentile</span></span>
<span><span class="fu"><a href="../reference/scatterplot.html">scatterplot</a></span><span class="op">(</span><span class="va">chlorophyll_data</span>,</span>
<span>            hline <span class="op">=</span> <span class="va">shark_statistics</span><span class="op">$</span><span class="va">P99</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The interactive plot is omitted here but appears in the online tutorial.</span></span></code></pre>
<hr>
</div>
<div class="section level2">
<h2 id="step-6-logical-parameter-checks">Step 6: Logical Parameter Checks<a class="anchor" aria-label="anchor" href="#step-6-logical-parameter-checks"></a>
</h2>
<p>Use <code><a href="../reference/check_parameter_rules.html">check_parameter_rules()</a></code> to flag measurements that
violate parameter-specific or row-wise logical rules.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_parameter_rules.html">check_parameter_rules</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No parameters from the logical rules are present in the dataset. Available parameters are: Total cover of all species, Cover, Cover class, Sediment deposition cover, Abundance class, Wet weight</span></span></code></pre>
<ul>
<li>
<code>return_df = TRUE</code> gives a data frame of violations.</li>
<li>
<code>return_logical = TRUE</code> gives logical vectors for each
parameter.</li>
<li>Only parameters present in the dataset are checked; available
parameters are listed if none match.</li>
<li>You can define custom rules by providing your own
<code>param_conditions</code> or <code>rowwise_conditions</code>
lists.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="step-7-station-matching">Step 7: Station Matching<a class="anchor" aria-label="anchor" href="#step-7-station-matching"></a>
</h2>
<p>Verify station names against the official SHARK registry:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">station_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_station.html">match_station</a></span><span class="op">(</span><span class="va">chlorophyll_data</span><span class="op">$</span><span class="va">station_name</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using station.txt from SHARK4R bundle: /tmp/RtmpbTtgdD/station.txt</span></span></code></pre>
<pre><code><span><span class="co">## All stations found</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">station_match</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   reported_station_name match_type</span></span>
<span><span class="co">## 1            425 GNIBEN       TRUE</span></span>
<span><span class="co">## 2                FLADEN       TRUE</span></span>
<span><span class="co">## 3                FLADEN       TRUE</span></span>
<span><span class="co">## 4                    M6       TRUE</span></span>
<span><span class="co">## 5              ANHOLT E       TRUE</span></span>
<span><span class="co">## 6              W SKAGEN       TRUE</span></span></code></pre>
<p>To plot stations and their distances from the station register in an
interactive map:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_station_distance.html">check_station_distance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span>,</span>
<span>                       plot_leaflet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The interactive map is omitted here but appears in the online tutorial.</span></span></code></pre>
<p>To check if stations are nominal (comparing unique coordinates per
station):</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_nominal_station.html">check_nominal_station</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chlorophyll_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Positions are not suspected to be nominal</span></span></code></pre>
<hr>
</div>
<div class="section level2">
<h2 id="interactive-qc-with-shiny">Interactive QC with Shiny<a class="anchor" aria-label="anchor" href="#interactive-qc-with-shiny"></a>
</h2>
<p>For a more user-friendly interface, use the Shiny QC app:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the app</span></span>
<span><span class="fu"><a href="../reference/run_qc_app.html">run_qc_app</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Alternative, download support files and knit documents locally</span></span>
<span><span class="fu"><a href="../reference/check_setup.html">check_setup</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># using a temp folder in this example</span></span></code></pre></div>
<p>The app provides point-and-click access to the same QC checks
described above.</p>
<hr>
</div>
<div class="section level2">
<h2 id="recommended-workflow-summary">Recommended Workflow Summary<a class="anchor" aria-label="anchor" href="#recommended-workflow-summary"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Check Required Fields</strong>
(<code><a href="../reference/check_datatype.html">check_datatype()</a></code>, <code><a href="../reference/check_fields.html">check_fields()</a></code>)<br>
</li>
<li>
<strong>Validate Codes</strong> (<code><a href="../reference/check_codes.html">check_codes()</a></code>)<br>
</li>
<li>
<strong>Geospatial Checks</strong> (<code><a href="../reference/plot_map_leaflet.html">plot_map_leaflet()</a></code>,
<code><a href="../reference/check_onland.html">check_onland()</a></code>, optional
<code><a href="../reference/positions_are_near_land.html">positions_are_near_land()</a></code>,
<code><a href="../reference/which_basin.html">which_basin()</a></code>)<br>
</li>
<li>
<strong>Depth Checks</strong> (<code><a href="../reference/check_depth.html">check_depth()</a></code>)<br>
</li>
<li>
<strong>Outlier Detection</strong> (<code><a href="../reference/check_outliers.html">check_outliers()</a></code>,
<code><a href="../reference/scatterplot.html">scatterplot()</a></code>)<br>
</li>
<li>
<strong>Logical Parameter Checks</strong>
(<code><a href="../reference/check_parameter_rules.html">check_parameter_rules()</a></code>)<br>
</li>
<li>
<strong>Station Matching</strong>
(<code><a href="../reference/match_station.html">match_station()</a></code>)<br>
</li>
<li>
<strong>Final Review &amp; Visualization</strong> (interactive maps
and scatterplots)</li>
</ol>
<p>Following this order ensures comprehensive QC and prepares your SHARK
data for analysis.</p>
<hr>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<pre><code><span><span class="co">## To cite package 'SHARK4R' in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Lindh, M. and Torstensson, A. (2025). SHARK4R: Accessing and</span></span>
<span><span class="co">##   Validating Marine Environmental Data from 'SHARK' and Related</span></span>
<span><span class="co">##   Databases. R package version 1.0.1.</span></span>
<span><span class="co">##   https://CRAN.R-project.org/package=SHARK4R</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Manual{,</span></span>
<span><span class="co">##     title = {SHARK4R: Accessing and Validating Marine Environmental Data from 'SHARK' and Related Databases},</span></span>
<span><span class="co">##     author = {Markus Lindh and Anders Torstensson},</span></span>
<span><span class="co">##     year = {2025},</span></span>
<span><span class="co">##     note = {R package version 1.0.1},</span></span>
<span><span class="co">##     url = {https://CRAN.R-project.org/package=SHARK4R},</span></span>
<span><span class="co">##   }</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Provoost P, Bosch S (2024). <code>obistools</code>: Tools for data
enhancement and quality control. Ocean Biodiversity Information System.
Intergovernmental Oceanographic Commission of UNESCO. R package version
0.1.0, <a href="https://iobis.github.io/obistools/" class="external-link uri">https://iobis.github.io/obistools/</a>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Markus Lindh, Anders Torstensson, SBDI.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
